{% extends 'base.html.twig' %}

{% block title %}Filument Foundry: Admin{% endblock %}

{% block body %}
<div class="flex-1 flex flex-col bg-[#f5ede5]">
    <main class="p-6 space-y-6">

        <!-- Header -->
        <div class="space-y-2">
            <h1 class="text-3xl font-extrabold text-gray-900 mb-0">Activity Logs</h1>
            <p class="text-gray-600 text-base mt-0">Track all user actions and system events in one place</p>
        </div>

        <!-- Search & Filter -->
        <div class="flex items-center justify-between mt-4 gap-3">

            <!-- Search Input -->
            <div class="flex items-center bg-white px-4 py-2 rounded-xl shadow w-full">
                <img src="{{ asset('images/partials/search.svg') }}"
                    alt="Search Icon"
                    style="width: 20px; height: 20px; margin-right: 20px;">
                <input 
                    type="text"
                    placeholder="Search logs..."
                    class="w-full focus:outline-none text-gray-700"
                    id="logsSearch"
                >
            </div>

            <!-- Role Filter -->
            <div class="relative inline-block">
                <select 
                    id="roleFilter"
                    class="ml-4 bg-white px-4 py-2 rounded-xl shadow text-gray-700 appearance-none"
                    style="padding-right: 3rem;"
                > 
                    <option>All Roles</option>
                    <option>Customer</option>
                    <option>Admin</option>
                    <option>Worker</option>
                </select>

                <div style="pointer-events: none; position: absolute; top: 0; bottom: 0; right: 0.5rem; display: flex; align-items: center;">
                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </div>
            </div>

        </div>

        <!-- Logs Table -->
        <div class="bg-white rounded-lg shadow overflow-hidden mt-6">
            <table id="logsTable" class="min-w-full divide-y divide-gray-200">
                <thead class="bg-white">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider w-1/4">User</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Email</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Role</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Action</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Target</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Timestamp</th>
                    </tr>
                </thead>

                <tbody class="divide-y divide-gray-100">
                    {% for log in logs %}
                    <tr class="hover:bg-[#F9F5F1] transition-colors">

                        <!-- FULL NAME -->
                        <td class="px-6 py-4 font-medium text-gray-900">
                            {{ log.userId.fullName }}
                        </td>

                        <!-- EMAIL -->
                        <td class="px-6 py-4 text-gray-700">
                            {{ log.userId.email }}
                        </td>

                        <!-- ROLE -->
                        <td class="px-6 py-4">
                            {% set roles = log.userId.roles %}
                            {% if 'ROLE_ADMIN' in roles %}
                                <span class="bg-[rgb(18,156,221)] text-white text-xs font-bold px-5 py-2 rounded-full">
                                    admin
                                </span>
                            {% elseif 'ROLE_WORKER' in roles %}
                                <span class="bg-[rgb(251,165,3)] text-black text-xs font-bold px-4 py-2 rounded-full">
                                    worker
                                </span>
                            {% else %}
                                <span class="bg-black text-white text-xs font-bold px-4 py-2 rounded-full">
                                    customer
                                </span>
                            {% endif %}
                        </td>

                        <!-- ACTION -->
                        <td class="px-6 py-4 text-gray-700">
                            {{ log.action }}
                        </td>

                        <!-- TARGET -->
                        <td class="px-6 py-4 text-gray-700">
                            {{ log.target ?? '-' }}
                        </td>

                        <!-- TIMESTAMP -->
                        <td class="px-6 py-4 text-gray-600">
                            {{ log.datetimestamp|date('m/d/Y H:i:s') }}
                        </td>

                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" class="px-6 py-4 text-center text-gray-500">
                            No logs found.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </main>
</div>
</div>
{% endblock %}
